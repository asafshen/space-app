!function(e){"use strict";var t=function(){return t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},t.apply(this,arguments)};function n(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function r(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function o(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function i(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n}function s(e){this.message=e}s.prototype=new Error,s.prototype.name="InvalidCharacterError";var a="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new s("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,o=0,i=0,a="";r=t.charAt(i++);~r&&(n=o%4?64*n+r:r,o++%4)?a+=String.fromCharCode(255&n>>(-2*o&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return a};function c(e){this.message=e}function u(e,t){if("string"!=typeof e)throw new c("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(a(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return a(t)}}(e.split(".")[n]))}catch(e){throw new c("Invalid token specified: "+e.message)}}c.prototype=new Error,c.prototype.name="InvalidTokenError";var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function d(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var h="__lodash_hash_undefined__",p="[object Function]",f="[object GeneratorFunction]",v=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,g=/^\w*$/,b=/^\./,y=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,m=/\\(\\)?/g,w=/^\[object .+?Constructor\]$/,I="object"==typeof l&&l&&l.Object===Object&&l,k="object"==typeof self&&self&&self.Object===Object&&self,j=I||k||Function("return this")();var O,x=Array.prototype,S=Function.prototype,_=Object.prototype,E=j["__core-js_shared__"],U=(O=/[^.]+$/.exec(E&&E.keys&&E.keys.IE_PROTO||""))?"Symbol(src)_1."+O:"",P=S.toString,R=_.hasOwnProperty,C=_.toString,T=RegExp("^"+P.call(R).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),D=j.Symbol,A=x.splice,M=z(j,"Map"),q=z(Object,"create"),L=D?D.prototype:void 0,$=L?L.toString:void 0;function N(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function J(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function K(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function B(e,t){for(var n,r,o=e.length;o--;)if((n=e[o][0])===(r=t)||n!=n&&r!=r)return o;return-1}function W(e,t){var n;t=function(e,t){if(Q(e))return!1;var n=typeof e;if("number"==n||"symbol"==n||"boolean"==n||null==e||Y(e))return!0;return g.test(e)||!v.test(e)||null!=t&&e in Object(t)}(t,e)?[t]:Q(n=t)?n:G(n);for(var r=0,o=t.length;null!=e&&r<o;)e=e[Z(t[r++])];return r&&r==o?e:void 0}function F(e){if(!X(e)||(t=e,U&&U in t))return!1;var t,n=function(e){var t=X(e)?C.call(e):"";return t==p||t==f}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?T:w;return n.test(function(e){if(null!=e){try{return P.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e))}function H(e,t){var n,r,o=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof t?"string":"hash"]:o.map}function z(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return F(n)?n:void 0}N.prototype.clear=function(){this.__data__=q?q(null):{}},N.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},N.prototype.get=function(e){var t=this.__data__;if(q){var n=t[e];return n===h?void 0:n}return R.call(t,e)?t[e]:void 0},N.prototype.has=function(e){var t=this.__data__;return q?void 0!==t[e]:R.call(t,e)},N.prototype.set=function(e,t){return this.__data__[e]=q&&void 0===t?h:t,this},J.prototype.clear=function(){this.__data__=[]},J.prototype.delete=function(e){var t=this.__data__,n=B(t,e);return!(n<0)&&(n==t.length-1?t.pop():A.call(t,n,1),!0)},J.prototype.get=function(e){var t=this.__data__,n=B(t,e);return n<0?void 0:t[n][1]},J.prototype.has=function(e){return B(this.__data__,e)>-1},J.prototype.set=function(e,t){var n=this.__data__,r=B(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},K.prototype.clear=function(){this.__data__={hash:new N,map:new(M||J),string:new N}},K.prototype.delete=function(e){return H(this,e).delete(e)},K.prototype.get=function(e){return H(this,e).get(e)},K.prototype.has=function(e){return H(this,e).has(e)},K.prototype.set=function(e,t){return H(this,e).set(e,t),this};var G=V((function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(Y(e))return $?$.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(t);var n=[];return b.test(e)&&n.push(""),e.replace(y,(function(e,t,r,o){n.push(r?o.replace(m,"$1"):t||e)})),n}));function Z(e){if("string"==typeof e||Y(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function V(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var s=e.apply(this,r);return n.cache=i.set(o,s),s};return n.cache=new(V.Cache||K),n}V.Cache=K;var Q=Array.isArray;function X(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Y(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==C.call(e)}var ee,te=function(e,t,n){var r=null==e?void 0:W(e,t);return void 0===r?n:r},ne="/v1/auth/accesskey/exchange",re="/v1/auth/otp/verify",oe="/v1/auth/otp/signin",ie="/v1/auth/otp/signup",se={email:"/v1/auth/otp/update/email",phone:"/v1/auth/otp/update/phone"},ae="/v1/auth/otp/signup-in",ce="/v1/auth/magiclink/verify",ue="/v1/auth/magiclink/signin",le="/v1/auth/magiclink/signup",de="/v1/auth/magiclink/pending-session",he={email:"/v1/auth/magiclink/update/email",phone:"/v1/auth/magiclink/update/email"},pe="/v1/auth/magiclink/signup-in",fe="/v1/auth/oauth/authorize",ve="/v1/auth/saml/authorize",ge="/v1/auth/totp/verify",be="/v1/auth/totp/signup",ye="/v1/user/totp/update",me={start:"/v1/auth/webauthn/signup/start",finish:"/v1/auth/webauthn/signup/finish"},we={start:"/v1/auth/webauthn/signin/start",finish:"/v1/auth/webauthn/signin/finish"},Ie={start:"v1/auth/webauthn/update/start",finish:"/v1/auth/webauthn/update/finish"},ke="/v1/flow/start",je="/v1/flow/next";!function(e){e.get="GET",e.delete="DELETE",e.post="POST",e.put="PUT"}(ee||(ee={}));const Oe=()=>{const e={};return{headers(t){const n="function"==typeof t.entries?Object.fromEntries(t.entries()):t;return e.Headers=JSON.stringify(n),this},body(t){return e.Body=t,this},url(t){return e.Url=t.toString(),this},method(t){return e.Method=t,this},title(t){return e.Title=t,this},status(t){return e.Status=t,this},build:()=>Object.keys(e).flatMap((t=>e[t]?[`${"Title"!==t?`${t}: `:""}${e[t]}`]:[])).join("\n")}},xe=(...e)=>new Headers(e.reduce(((e,t)=>{const n=(e=>Array.isArray(e)?e:e instanceof Headers?Array.from(e.entries()):e?Object.entries(e):[])(t);return n.reduce(((t,[n,r])=>(e[n]=r,e)),e),e}),{})),Se=e=>void 0===e?void 0:JSON.stringify(e),_e=(e,t="")=>{let n=e;return""!==t&&(n=n+":"+t),{Authorization:`Bearer ${n}`}},Ee=({baseUrl:e,projectId:t,baseConfig:n,logger:r,hooks:o,cookiePolicy:i})=>{const s=((e,t)=>{const n=t||fetch;if(!n)throw new Error("fetch is not defined");return e?async(...t)=>{e.log((e=>Oe().title("Request").url(e[0]).method(e[1].method).headers(e[1].headers).body(e[1].body).build())(t));const r=await n(...t);return e[r.ok?"log":"error"](await(async e=>{const t=await e.text();return e.text=()=>Promise.resolve(t),e.json=()=>Promise.resolve(JSON.parse(t)),Oe().title("Response").url(e.url.toString()).status(`${e.status} ${e.statusText}`).headers(e.headers).body(t).build()})(r)),r}:n})(r),a=async r=>{const a=(null==o?void 0:o.beforeRequest)?o.beforeRequest(r):r,{path:c,body:u,headers:l,queryParams:d,method:h,token:p}=a,f=await s((({path:e,baseUrl:t,queryParams:n})=>{const r=new URL(e,t);return n&&(r.search=new URLSearchParams(n).toString()),r})({path:c,baseUrl:e,queryParams:d}),{headers:xe(_e(t,p),(null==n?void 0:n.baseHeaders)||{},l),method:h,body:Se(u),credentials:i||"include"});return(null==o?void 0:o.afterRequest)&&o.afterRequest(r,null==f?void 0:f.clone()),f};return{get:(e,{headers:t,queryParams:n,token:r}={})=>a({path:e,headers:t,queryParams:n,body:void 0,method:ee.get,token:r}),post:(e,t,{headers:n,queryParams:r,token:o}={})=>a({path:e,headers:n,queryParams:r,body:t,method:ee.post,token:o}),put:(e,t,{headers:n,queryParams:r,token:o}={})=>a({path:e,headers:n,queryParams:r,body:t,method:ee.put,token:o}),delete:(e,t,{headers:n,queryParams:r,token:o}={})=>a({path:e,headers:n,queryParams:r,body:t,method:ee.delete,token:o})}},Ue=e=>{if("string"!=typeof e||!e)throw new Error("Invalid token provided");const{exp:t}=u(e);return(new Date).getTime()/1e3>t},Pe=(...e)=>e.join("/").replace(/\/{2,}/g,"/");async function Re(e){const t=await e,n={code:t.status,ok:t.ok,response:t},r=await t.json();return t.ok?n.data=r:n.error=r,n}const Ce=(e,t)=>(n=t)=>t=>!e(t)&&n.replace("{val}",t),Te=(...e)=>({validate:t=>(e.forEach((e=>{const n=e(t);if(n)throw new Error(n)})),!0)}),De=e=>t=>e.test(t),Ae=De(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/),Me=De(/^\+[1-9]{1}[0-9]{3,14}$/),qe=Ce(Ae,'"{val}" is not a valid email'),Le=Ce(Me,'"{val}" is not a valid phone number'),$e=Ce((1,e=>e.length>=1),"Minimum length is 1");const Ne=Ce((e=>"string"==typeof e),"Input is not a string"),Je=(...e)=>t=>(...n)=>(e.forEach(((e,t)=>Te(...e).validate(n[t]))),t(...n)),Ke=e=>[Ne(`"${e}" must be a string`),$e(`"${e}" must not be empty`)],Be=e=>[Ne(`"${e}" must be a string`),qe()],We=e=>[Ne(`"${e}" must be a string`),Le()],Fe=Je(Ke("accessKey")),He=e=>({exchange:Fe((t=>Re(e.get(ne,{token:t}))))});var ze,Ge,Ze,Ve;!function(e){e.sms="sms",e.whatsapp="whatsapp"}(ze||(ze={})),function(e){e.email="email",e.sms="sms",e.whatsapp="whatsapp"}(Ge||(Ge={})),function(e){e.signUp="signup",e.signIn="signin",e.verify="verify"}(Ze||(Ze={})),function(e){e.signUp="signup",e.signIn="signin",e.verify="verify",e.updatePhone="updatePhone"}(Ve||(Ve={}));const Qe=Ke("identifier"),Xe=Je(Qe,Ke("code")),Ye=Je(Qe),et=Je(Qe,We("phone")),tt=Je(Qe,Be("email")),nt=e=>({verify:Object.keys(Ge).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:Xe(((t,r)=>Re(e.post(Pe(re,n),{code:r,externalId:t}))))})),{}),signIn:Object.keys(Ge).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:Ye((t=>Re(e.post(Pe(oe,n),{externalId:t}))))})),{}),signUp:Object.keys(Ge).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:Ye(((t,r)=>Re(e.post(Pe(ie,n),{externalId:t,user:r}))))})),{}),signUpOrIn:Object.keys(Ge).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:Ye((t=>Re(e.post(Pe(ae,n),{externalId:t}))))})),{}),update:{email:tt(((t,n,r)=>Re(e.post(se.email,{externalId:t,email:n},{token:r})))),phone:Object.keys(ze).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:et(((t,r,o)=>Re(e.post(Pe(se.phone,n),{externalId:t,phone:r},{token:o}))))})),{})}}),rt=Ke("identifier"),ot=Ke("uri"),it=Je(Ke("token")),st=Je(rt,ot),at=Je(Ke("pendingRef")),ct=Je(rt,We("phone"),ot),ut=Je(rt,Be("email"),ot),lt=e=>({verify:it((t=>Re(e.post(ce,{token:t})))),signIn:Object.keys(Ge).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:st(((t,r)=>Re(e.post(Pe(ue,n),{externalId:t,URI:r,crossDevice:!0}))))})),{}),signUpOrIn:Object.keys(Ge).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:st(((t,r)=>Re(e.post(Pe(pe,n),{externalId:t,URI:r,crossDevice:!0}))))})),{}),signUp:Object.keys(Ge).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:st(((t,r,o)=>Re(e.post(Pe(le,n),{externalId:t,URI:r,user:o,crossDevice:!0}))))})),{}),waitForSession:at(((t,n)=>new Promise((r=>{const{pollingIntervalMs:o,timeoutMs:i}=(({pollingIntervalMs:e=1e3,timeoutMs:t=6e5}={})=>({pollingIntervalMs:Math.max(e||1e3,1e3),timeoutMs:Math.min(t||6e5,6e5)}))(n);let s;const a=setInterval((async()=>{const n=await e.post(de,{pendingRef:t});n.ok&&(clearInterval(a),s&&clearTimeout(s),r(Re(Promise.resolve(n))))}),o);s=setTimeout((()=>{r({error:{message:`Session polling timeout exceeded: ${i}ms`,code:"0"},ok:!1}),clearInterval(a)}),i)})))),update:{email:ut(((t,n,r,o)=>Re(e.post(he.email,{externalId:t,email:n,URI:r,crossDevice:!0},{token:o})))),phone:Object.keys(ze).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:ct(((t,r,o,i)=>Re(e.post(Pe(he.phone,n),{externalId:t,phone:r,URI:o,crossDevice:!0},{token:i}))))})),{})}}),dt=e=>({verify:it((t=>Re(e.post(ce,{token:t})))),signIn:Object.keys(Ge).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:st(((t,r)=>Re(e.post(Pe(ue,n),{externalId:t,URI:r}))))})),{}),signUp:Object.keys(Ge).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:st(((t,r,o)=>Re(e.post(Pe(le,n),{externalId:t,URI:r,user:o}))))})),{}),signUpOrIn:Object.keys(Ge).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:st(((t,r)=>Re(e.post(Pe(pe,n),{externalId:t,URI:r}))))})),{}),update:{email:ut(((t,n,r,o)=>Re(e.post(he.email,{externalId:t,email:n,URI:r},{token:o})))),phone:Object.keys(ze).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:ct(((t,r,o,i)=>Re(e.post(Pe(he.phone,n),{externalId:t,phone:r,URI:o},{token:i}))))})),{})},crossDevice:lt(e)}),ht=Je(Ke("code")),pt=e=>({exchange:ht((t=>Re(e.get("/v1/auth/exchange",{queryParams:{code:t}}))))});var ft;!function(e){e.facebook="facebook",e.github="github",e.google="google",e.microsoft="microsoft",e.gitlab="gitlab",e.apple="apple"}(ft||(ft={}));const vt=e=>Object.assign({start:Object.keys(ft).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:async(t,{redirect:r=!1}={})=>{const o=await e.get(fe,{queryParams:Object.assign({provider:n},t&&{redirectURL:t})});if(!r||!o.ok)return Re(Promise.resolve(o));const{url:i}=await o.json();window.location.href=i}})),{})},pt(e)),gt=Je(Ke("flowId")),bt=Je(Ke("executionId"),Ke("stepId"),Ke("interactionId")),yt=e=>({start:gt((t=>Re(e.post(ke,{flowId:t})))),next:bt(((t,n,r,o)=>Re(e.post(je,{executionId:t,stepId:n,interactionId:r,input:o}))))}),mt=Je(Ke("tenant")),wt=e=>Object.assign({start:mt((async(t,n,{redirect:r=!1}={})=>{const o=await e.get(ve,{queryParams:{tenant:t,redirectURL:n}});if(!r||!o.ok)return Re(Promise.resolve(o));const{url:i}=await o.json();window.location.href=i}))},pt(e)),It=Ke("identifier"),kt=Je(It,Ke("code")),jt=Je(It),Ot=Je(It),xt=e=>({signUp:jt(((t,n)=>Re(e.post(be,{externalId:t,user:n})))),verify:kt(((t,n)=>Re(e.post(ge,{externalId:t,code:n})))),update:Ot(((t,n)=>Re(e.post(ye,{externalId:t},{token:n}))))}),St=Ke("identifier"),_t=Ke("origin"),Et=Je(St,_t,Ke("name")),Ut=Je(St,_t),Pt=Je(St,_t,Ke("token")),Rt=Je(Ke("transactionId"),Ke("response")),Ct=e=>({signUp:{start:Et(((t,n,r)=>Re(e.post(me.start,{user:{externalId:t,name:r},origin:n})))),finish:Rt(((t,n)=>Re(e.post(me.finish,{transactionId:t,response:n}))))},signIn:{start:Ut(((t,n)=>Re(e.post(we.start,{externalId:t,origin:n})))),finish:Rt(((t,n)=>Re(e.post(we.finish,{transactionId:t,response:n}))))},update:{start:Pt(((t,n,r)=>Re(e.post(Ie.start,{externalId:t,origin:n},{token:r})))),finish:Rt(((t,n)=>Re(e.post(Ie.finish,{transactionId:t,response:n}))))}}),Tt=Je(Ke("token"));var Dt;const At=Je([("projectId",Dt=Ke("projectId"),Ce(((e,t)=>e=>Te(...t).validate(te(e,"projectId")))(0,Dt))())])((({projectId:e,logger:t,baseUrl:n,hooks:r,cookiePolicy:o})=>{return i=Ee({baseUrl:n||"https://api.descope.com",projectId:e,logger:t,hooks:r,cookiePolicy:o}),{accessKey:He(i),otp:nt(i),magicLink:dt(i),oauth:vt(i),saml:wt(i),totp:xt(i),webauthn:Ct(i),flow:yt(i),refresh:e=>Re(i.get("/v1/auth/refresh",{token:e})),logout:e=>Re(i.get("/v1/auth/logoutall",{token:e})),me:e=>Re(i.get("/v1/auth/me",{token:e})),isJwtExpired:Tt(Ue),httpClient:i};var i}));function Mt(e,t,n){return void 0===n&&(n=0),t(n).catch((function(r){if(n>=e.maxRetries||!e.shouldRetry(r))throw r;var o,i,s,a,c=(o=e.baseDelay,i=e.maxDelay,s=e.baseDelay*Math.pow(2,n),Math.max(o,Math.min(i,s)));return(a=c,new Promise((function(e){return setTimeout(e,a)}))).then((function(){return Mt(e,t,n+1)}))}))}At.DeliveryMethods=Ge;var qt="Failed to load the JS script of the agent";function Lt(e){var r,o=e.scriptUrlPattern,i=e.token,s=e.apiKey,a=void 0===s?i:s,c=n(e,["scriptUrlPattern","token","apiKey"]),u=(r=e,"scriptUrlPattern",Object.prototype.hasOwnProperty.call(r,"scriptUrlPattern")?o:void 0),l=[];return Promise.resolve().then((function(){if(!a||"string"!=typeof a)throw new Error("API key required");return Mt({maxRetries:5,baseDelay:100,maxDelay:3e3,shouldRetry:function(e){return!(e instanceof Error&&"Blocked by CSP"===e.message)}},(function(){var e,t=new Date,n=function(){return l.push({startedAt:t,finishedAt:new Date})},r=function(e,t,n,r){var o,i=document,s="securitypolicyviolation",a=function(t){var n=new URL(e,location.href),r=t.blockedURI;r!==n.href&&r!==n.protocol.slice(0,-1)&&r!==n.origin||(o=t,c())};i.addEventListener(s,a);var c=function(){return i.removeEventListener(s,a)};return Promise.resolve().then(t).then((function(e){return c(),e}),(function(e){return new Promise((function(e){return setTimeout(e)})).then((function(){if(c(),o)return function(){throw new Error("Blocked by CSP")}();throw e}))}))}(e=function(e,t){void 0===t&&(t="https://fpnpmcdn.net/v<version>/<apiKey>/loader_v<loaderVersion>.js");var n=encodeURIComponent;return t.replace(/<[^<>]+>/g,(function(t){return"<version>"===t?"3":"<apiKey>"===t?n(e):"<loaderVersion>"===t?n("3.7.1"):t}))}(a,u),(function(){return function(e){return new Promise((function(t,n){var r=document.createElement("script"),o=function(){var e;return null===(e=r.parentNode)||void 0===e?void 0:e.removeChild(r)},i=document.head||document.getElementsByTagName("head")[0];r.onload=function(){o(),t()},r.onerror=function(){o(),n(new Error(qt))},r.async=!0,r.src=e,i.appendChild(r)}))}(e)}));return r.then(n,n),r}))})).then((function(){var e=window,n="__fpjs_p_l_b",r=e[n];if(function(e,t){var n,r=null===(n=Object.getOwnPropertyDescriptor)||void 0===n?void 0:n.call(Object,e,t);(null==r?void 0:r.configurable)?delete e[t]:r&&!r.writable||(e[t]=void 0)}(e,n),"function"!=typeof(null==r?void 0:r.load))throw new Error(qt);return r.load(t(t({},c),{ldi:{attempts:l}}))}))}var $t={exports:{}},Nt={exports:{}};Nt.exports=function(){function e(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}function t(n,r){function o(t,o,i){if("undefined"!=typeof document){"number"==typeof(i=e({},r,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var a in i)i[a]&&(s+="; "+a,!0!==i[a]&&(s+="="+i[a].split(";")[0]));return document.cookie=t+"="+n.write(o,t)+s}}function i(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],r={},o=0;o<t.length;o++){var i=t[o].split("="),s=i.slice(1).join("=");try{var a=decodeURIComponent(i[0]);if(r[a]=n.read(s,a),e===a)break}catch(e){}}return e?r[e]:r}}return Object.create({set:o,get:i,remove:function(t,n){o(t,"",e({},n,{expires:-1}))},withAttributes:function(n){return t(this.converter,e({},this.attributes,n))},withConverter:function(n){return t(e({},this.converter,n),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(n)}})}return t({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}(),function(e){e.exports=Nt.exports}($t);var Jt=d($t.exports);const Kt=e=>{const t=Lt({apiKey:e||"A9aCLRHzKCv3uL69oqDr"});return{get:async()=>{try{let e=sessionStorage.getItem("vsid");e||(e=(e=>new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t.toString())})[e])("vsid")),e||(e=(Date.now().toString(36)+Math.random().toString(36).substring(2)+Math.random().toString(36).substring(2)).substring(0,27)),sessionStorage.setItem("vsid",e);const n=await t,r=await n.get({linkedId:e});sessionStorage.setItem("vrid",r.requestId)}catch(e){global.FB_DEBUG&&console.error(e)}}}};let Bt=[];function Wt(e,t){const n=function(e){const t=e.split(".");try{if(3===t.length){const t=JSON.parse(window.atob(e.split(".")[1]));if(t.exp)return new Date(1e3*t.exp)}}catch(e){}return null}(t);if(n){let t;for(;t=Bt.pop();)clearTimeout(t);const r=n.getTime()-2e4-(new Date).getTime(),o=setTimeout((()=>{const t=Ft();t&&e(t)}),r);Bt.push(o)}}function Ft(){return localStorage?null===localStorage||void 0===localStorage?void 0:localStorage.getItem("DSR"):""}var Ht=e=>{var{persistTokens:t=!0}=e,r=n(e,["persistTokens"]);Kt(r.fpKey).get().catch((()=>null));const o=r;let i;if(o.hooks={beforeRequest:e=>{var n;return e.queryParams=(n=e.queryParams,Object.assign(Object.assign({},n),{vsid:sessionStorage.getItem("vsid")||"",vrid:sessionStorage.getItem("vrid")||""})),t&&!e.token&&(e.token=Ft()),e}},t&&(o.hooks.afterRequest=async(e,t)=>{!async function(e,t,n){try{const t=await(null==n?void 0:n.json());if(t){const n=function(e){const{sessionJwt:t,refreshJwt:n}=e||{};return function(e,{cookiePath:t,cookieDomain:n,cookieExpiration:r}){e&&Jt.set("DS",e,{path:t,domain:n,expires:r,sameSite:"None",secure:!0})}(t,e||{}),function(e){localStorage&&e&&localStorage.setItem("DSR",e)}(n),t}((null==t?void 0:t.authInfo)||t);n&&Wt(e,n)}}catch(e){console.error("Could not set tokens from body",e)}}(i.refresh,0,t)}),i=At(r),t){const e=i.logout;i.logout=(...t)=>(localStorage&&localStorage.removeItem("DSR"),Jt.remove("DS"),e(...t))}return i};const zt=(null===localStorage||void 0===localStorage?void 0:localStorage.getItem("base.content.url"))||"https://static.prod.descope.com/pages",Gt="descope-login-flow",Zt="code",Vt="redirect",Qt="poll",Xt="webauthnCreate",Yt="webauthnGet";function en(e){return new URLSearchParams(window.location.search).get(e)}function tn(){return en(Gt)}function nn(e){if(window.history.replaceState&&en(e)){const t=new URL(window.location.href),n=new URLSearchParams(t.search);n.delete(e),t.search=n.toString(),window.history.replaceState({},"",t.toString())}}var rn;function on(e){return r(this,void 0,void 0,(function*(){const t=yield fetch(e,{cache:"default"});if(!t.ok)throw new Error(e);return t.text()}))}function sn(e,t,n){const r=new URL(zt);return r.pathname+=`/${e}/${t}.${n}`,r.toString()}function an(e,t){if(!Number.isNaN(e)&&!Number.isNaN(t))return e>t?rn.forward:e<t?rn.backward:void 0}!function(e){e.backward="backward",e.forward="forward"}(rn||(rn={}));const cn=()=>{const[e="",t=""]=(tn()||"").split("_");return{executionId:e,stepId:t}},un=(e,t)=>{!function(e){if(window.history.pushState&&e!==tn()){const t=new URL(window.location.href),n=new URLSearchParams(t.search);n.set(Gt,e),t.search=n.toString(),window.history.pushState({},"",t.toString())}}([e,t].join("_"))};function ln(){nn(Gt)}const dn=(e,t,n="")=>{e.querySelectorAll(`[data-type="${t}"]`).forEach((e=>{e.innerText=n,e.classList[n?"remove":"add"]("hide")}))},hn=e=>e.replace(/-./g,(e=>e[1].toUpperCase()));var pn,fn,vn,gn,bn,yn,mn,wn,In,kn,jn,On,xn,Sn,_n,En,Un,Pn,Rn,Cn,Tn,Dn,An,Mn,qn;class Ln{constructor(e={}){pn.set(this,void 0),fn.set(this,{}),vn.set(this,0),i(this,pn,e,"f")}get current(){return Object.assign({},o(this,pn,"f"))}update(e){const t="function"==typeof e?e(o(this,pn,"f")):e,n=Object.assign(Object.assign({},o(this,pn,"f")),t);if(!function(e,t){const n=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);if(n.length!==r.length)return!1;for(let r=0;r<n.length;r+=1){const o=n[r];if(e[o]!==t[o])return!1}return!0}(o(this,pn,"f"),n)){const e=o(this,pn,"f");i(this,pn,n,"f"),Object.freeze(o(this,pn,"f")),setTimeout((()=>{Object.values(o(this,fn,"f")).forEach((t=>t(n,e,((e,t)=>n=>e[n]!==t[n])(n,e))))}),0)}}subscribe(e){return i(this,vn,o(this,vn,"f")+1,"f"),o(this,fn,"f")[o(this,vn,"f")]=e,o(this,vn,"f").toString()}unsubscribe(e){const t=!!o(this,fn,"f")[e];return t&&delete o(this,fn,"f")[e],t}unsubscribeAll(){return i(this,fn,{},"f"),!0}}function $n(e){return r(this,void 0,void 0,(function*(){const t=function(e){var t;const n=JSON.parse(e);return n.publicKey.challenge=Jn(n.publicKey.challenge),n.publicKey.user.id=Jn(n.publicKey.user.id),null===(t=n.publicKey.excludeCredentials)||void 0===t||t.forEach((e=>{e.id=Jn(e.id)})),n}(e),n=yield navigator.credentials.create(t);return r=n,JSON.stringify({id:r.id,rawId:Kn(r.rawId),type:r.type,response:{attestationObject:Kn(r.response.attestationObject),clientDataJSON:Kn(r.response.clientDataJSON)}});var r}))}function Nn(e){return r(this,void 0,void 0,(function*(){const t=function(e){var t;const n=JSON.parse(e);return n.publicKey.challenge=Jn(n.publicKey.challenge),null===(t=n.publicKey.allowCredentials)||void 0===t||t.forEach((e=>{e.id=Jn(e.id)})),n}(e),n=yield navigator.credentials.get(t);return r=n,JSON.stringify({id:r.id,rawId:Kn(r.rawId),type:r.type,response:{authenticatorData:Kn(r.response.authenticatorData),clientDataJSON:Kn(r.response.clientDataJSON),signature:Kn(r.response.signature),userHandle:Kn(r.response.userHandle)}});var r}))}function Jn(e){const t=e.replace(/-/g,"+").replace(/_/g,"/");return Uint8Array.from(atob(t),(e=>e.charCodeAt(0))).buffer}function Kn(e){return btoa(String.fromCharCode.apply(null,new Uint8Array(e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}pn=new WeakMap,fn=new WeakMap,vn=new WeakMap,function(e){e.waiting="waiting",e.completed="completed",e.failed="failed",e.running="running"}(gn||(gn={}));const Bn=document.createElement("template");Bn.innerHTML="\n\t<style>\n\t\t:host {\n\t\t\tdisplay: inline-block;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t}\n\t\t\n\t\tform {\n\t\t\theight: 100%;\n\t\t\ttransition: opacity 300ms ease-in-out;\n\t\t}\n\n\t\t.fade-out {\n\t\t\topacity: 0.1;\n\t\t}\n\n\t</style>\n\t<form></form>\n\t";class Wn extends HTMLElement{constructor(){super(),bn.add(this),yn.set(this,!1),mn.set(this,new Ln),wn.set(this,new Ln),In.set(this,void 0),kn.set(this,void 0),jn.set(this,void 0),On.set(this,{popstate:o(this,bn,"m",En).bind(this)}),xn.set(this,void 0),Cn.set(this,(e=>{var t;if(o(this,bn,"m",Pn).call(this,e))return;const{executionId:n,stepId:r,status:i,action:s,screen:a,redirect:c,authInfo:u,error:l,webauthn:d}=e.data;o(this,bn,"m",Un).call(this,i,l,u)||o(this,mn,"f").update({stepId:r,executionId:n,action:s,redirectUrl:null==c?void 0:c.url,screenId:null==a?void 0:a.id,screenErrorText:null===(t=null==a?void 0:a.state)||void 0===t?void 0:t.errorText,webauthnTransactionId:null==d?void 0:d.transactionId,webauthnOptions:null==d?void 0:d.options})})),o(this,bn,"m",Sn).call(this),o(this,mn,"f").subscribe(o(this,bn,"m",Rn).bind(this)),o(this,wn,"f").subscribe(o(this,bn,"m",Dn).bind(this))}static get observedAttributes(){return["project-id","flow-id","base-url"]}get"project-id"(){return this.getAttribute("project-id")}get"flow-id"(){return this.getAttribute("flow-id")}get"base-url"(){return this.getAttribute("base-url")||void 0}connectedCallback(){if(this.shadowRoot.isConnected){i(this,yn,!0,"f"),o(this,bn,"m",_n).call(this),o(this,bn,"m",qn).call(this);const{executionId:e,stepId:t}=cn(),n=en("t")||void 0;n&&nn("t");const r=en(Zt)||void 0;r&&nn(Zt),o(this,mn,"f").update({projectId:this["project-id"],flowId:this["flow-id"],baseUrl:this["base-url"],stepId:t,executionId:e,token:n,code:r}),window.addEventListener("popstate",o(this,On,"f").popstate),o(this,In,"f").onkeydown=e=>{"Enter"===e.key&&e.preventDefault()}}}disconnectedCallback(){o(this,mn,"f").unsubscribeAll(),o(this,wn,"f").unsubscribeAll(),window.removeEventListener("popstate",o(this,On,"f").popstate)}attributeChangedCallback(e,t,n){if(this.shadowRoot.isConnected&&o(this,yn,"f")&&t!==n&&Wn.observedAttributes.includes(e)){o(this,bn,"m",_n).call(this);const r=null===t;o(this,mn,"f").update((({stepId:t,executionId:o})=>{let i=t,s=o;return r||(s=null,i=null,ln()),{[hn(e)]:n,stepId:i,executionId:s}}))}}}yn=new WeakMap,mn=new WeakMap,wn=new WeakMap,In=new WeakMap,kn=new WeakMap,jn=new WeakMap,On=new WeakMap,xn=new WeakMap,Cn=new WeakMap,bn=new WeakSet,Sn=function(){this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Bn.content.cloneNode(!0)),i(this,In,this.shadowRoot.querySelector("form"),"f"),i(this,kn,this.shadowRoot.querySelector("style"),"f")},_n=function(){const e=["base-url"];Wn.observedAttributes.forEach((t=>{if(!e.includes(t)&&!this[t])throw Error(`${t} cannot be empty`)}))},En=function(){const{stepId:e,executionId:t}=cn();o(this,mn,"f").update({stepId:e,executionId:t})},Un=function(e,t,n){switch(e){case gn.failed:return ln(),o(this,bn,"m",Mn).call(this,"error",t),!0;case gn.completed:return ln(),o(this,bn,"m",Mn).call(this,"success",n),!0;default:return!1}},Pn=function({ok:e,error:t}){return e||o(this,bn,"m",Mn).call(this,"error",t),!e},Rn=function(e,t,n){return r(this,void 0,void 0,(function*(){const{projectId:s,flowId:a,baseUrl:c,stepId:u,executionId:l,action:d,screenId:h,screenErrorText:p,redirectUrl:f,token:v,code:g,webauthnTransactionId:b,webauthnOptions:y}=e,m=n("projectId")||n("baseUrl");if(o(this,jn,"f")&&(clearInterval(o(this,jn,"f")),i(this,jn,null,"f")),m){if(!s)return;i(this,xn,Ht({projectId:s,baseUrl:c}),"f")}if(!l){if(!a)return;const e=yield o(this,xn,"f").flow.start(a);return void o(this,Cn,"f").call(this,e)}if(n("token")&&v||n("code")&&g){const e=yield o(this,xn,"f").flow.next(l,u,"submit",{token:v,code:g});return un(e.data.executionId,e.data.stepId),o(this,Cn,"f").call(this,e),void o(this,mn,"f").update({token:void 0,code:void 0})}if(d===Vt)return f?void window.location.assign(f):void console.error("Did not get redirect url");if(d===Xt||d===Yt){if(!b||!y)return void console.error("Did not get webauthn transaction id or options");const e=d===Xt?yield $n(y):yield Nn(y),t=yield o(this,xn,"f").flow.next(l,u,"submit",{transactionId:b,response:e});return void o(this,Cn,"f").call(this,t)}if(d===Qt&&i(this,jn,setInterval((()=>r(this,void 0,void 0,(function*(){const e=yield o(this,xn,"f").flow.next(l,u,"submit",{});o(this,Cn,"f").call(this,e)}))),2e3),"f"),!h)return void console.error("Refreshing the page during a flow is not supported yet");const w={direction:an(+u,+t.stepId),screenErrorText:p,htmlUrl:sn(s,h,"html")};(m||n("executionId")||n("stepId"))&&(w.next=(...e)=>o(this,xn,"f").flow.next(l,u,...e)),o(this,wn,"f").update(w)}))},Tn=function(e){o(this,In,"f").onsubmit=t=>r(this,void 0,void 0,(function*(){var n;const r=null===(n=t.submitter)||void 0===n?void 0:n.getAttribute("id");t.preventDefault();const i=Object.fromEntries(new FormData(t.target).entries()),s=(a=t.submitter,Array.from((null==a?void 0:a.attributes)||[]).reduce(((e,t)=>{var n;const r=null===(n=new RegExp("^data-descope-(\\S+)$").exec(t.name))||void 0===n?void 0:n[1];return r?Object.assign(e,{[r]:t.value}):e}),{}));var a;const c=yield e(r,Object.assign(Object.assign(Object.assign({},s),i),{origin:window.location.origin}));un(c.data.executionId,c.data.stepId),o(this,Cn,"f").call(this,c)}))},Dn=function(e,t,n){return r(this,void 0,void 0,(function*(){const t="error-message",{htmlUrl:r,validations:i={},direction:s,next:a,screenErrorText:c}=e;if(!n("htmlUrl"))return n("next")&&o(this,bn,"m",Tn).call(this,a),void(n("screenErrorText")&&dn(this.shadowRoot,t,c));const u=document.createElement("template");u.innerHTML=yield on(r);const l=u.content.cloneNode(!0),d=(e=>{var t;const n=Array.from(e.querySelectorAll("script[data-id]")).map((t=>{var n;const r=t.getAttribute("data-id"),o=null===(n=e.getElementById(r))||void 0===n?void 0:n.innerHTML,i=Function(o).bind(t.previousSibling);return t.remove(),i}));return null===(t=e.querySelector("scripts"))||void 0===t||t.remove(),n})(l),h=()=>{!function(e,t){Object.entries(t).forEach((([t,n])=>{const r=e.getElementById(t);if(!r)throw new Error(`Cannot find element with id: ${t}`);Object.entries(n).forEach((([e,t])=>{r.setAttribute(e,t.toString()),r.addEventListener("blur",(()=>r.classList.add("touched")),{once:!0})}))}))}(l,i),dn(l,t,c);try{d.forEach((e=>e()))}catch(e){console.error(e)}o(this,In,"f").replaceChildren(l),o(this,bn,"m",Tn).call(this,a),o(this,bn,"m",Mn).call(this,"page-updated",{})};s?o(this,bn,"m",An).call(this,h,s):h()}))},An=function(e,t){o(this,In,"f").addEventListener("transitionend",(()=>{o(this,In,"f").classList.remove("fade-out"),e()}),{once:!0});const n=t===rn.forward?"slide-forward":"slide-backward";Array.from(o(this,In,"f").getElementsByClassName("input-container")).forEach(((e,t)=>{e.style["transition-delay"]=40*t+"ms",e.classList.add(n)})),o(this,In,"f").classList.add("fade-out")},Mn=function(e,t){this.dispatchEvent(new CustomEvent(e,{detail:t}))},qn=function(){return r(this,void 0,void 0,(function*(){const e=document.createElement("style"),t=sn(this["project-id"],"theme","css");e.innerText=yield on(t),this.shadowRoot.appendChild(e)}))},customElements.define("descope-wc",Wn),e.createSdk=Ht,e.default=Wn,Object.defineProperty(e,"__esModule",{value:!0})}({});
